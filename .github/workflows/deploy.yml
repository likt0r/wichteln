name: Development

on:
  workflow_run:
    workflows:
      - CI
    types:
      - completed
    branches:
      - main
  workflow_dispatch:

env:
  STACK_NAME: ${{ github.repository }}

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: mean-robot
    steps:
      - name: Deploy to DEV Environment
        uses: faktenforum/portami@main
        with:
          endpoint: "${{ vars.MEAN_ROBOT_PORTAINER_URL }}"
          access_token: ${{ secrets.MEAN_ROBOT_PORTAINER_ACCESSTOKEN }}
          stack_name: "${{ env.STACK_NAME }}"
          prune: true
          pull: true
